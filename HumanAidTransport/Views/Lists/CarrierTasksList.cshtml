@model IEnumerable<TransportOrder>

@{
    ViewData["Title"] = "Carrier Order List";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <link rel="stylesheet" href="~/css/lists/carriertasklist.css" asp-append-version="true" />

    <script src="~/js/lists/carriertasklist.js" asp-append-version="true" defer></script>
</head>
<body>

    @if (TempData["CompleteMessage"] != null)
    {
        <div class="alert success-alert" id="success-alert">@TempData["CompleteMessage"]</div>
    }

    @if (TempData["CancelMessage"] != null)
    {
        <div class="alert error-alert" id="error-alert">@TempData["CancelMessage"]</div>
    }

    @if (TempData["ProgressMessage"] != null)
    {
        <div class="alert progress-alert" id="progress-alert">@TempData["ProgressMessage"]</div>
    }

    <h2 class="title">Carrier Order List</h2>

    <div class="task-filters">
        <input type="text" id="searchTask" class="filter-input" placeholder="Search by task name...">

        <select id="statusFilter" class="filter-dropdown">
            <option value="">All Statuses</option>
            <option value="New">New</option>
            <option value="In progress">In progress</option>
            <option value="Completed">Completed</option>
            <option value="Rejected">Rejected</option>
        </select>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="orders-container">
            @foreach (var order in Model)
            {
                <div class="order-card @(order.Status == "Completed" ? "completed" :
                        order.Status == "Rejected" ? "rejected" :
                        order.Status == "New" ? "new" :
                        order.Status == "In progress" ? "in-progress" : "")">

                    <div class="order-header">
                        <h3>🚚 @order.Name</h3>
                        <span class="status @(order.Status == "Completed" ? "completed" :
                        order.Status == "Rejected" ? "rejected" :
                        order.Status == "New" ? "new" :
                        order.Status == "In progress" ? "in-progress" : "")">@order.Status</span>
                    </div>

                    <div class="order-details">
                        <p><strong>From:</strong> @order.DeliveryAddressFrom</p>
                        <p><strong>To:</strong> @order.DeliveryAddressTo</p>
                        <p><strong>Payment:</strong> 💰 $@order.Payment</p>
                    </div>

                    <div class="order-actions">
                        @if (order.Status == "New")
                        {
                            <form method="post" asp-controller="OrderTask" asp-action="MarkAsInProgress" asp-route-orderId="@order.OrderId">
                                <button type="submit" class="btn in-progress-btn">🔄 Start Task</button>
                            </form>
                            <form method="post" asp-controller="OrderTask" asp-action="CancelTask" asp-route-orderId="@order.OrderId">
                                <button type="submit" class="btn cancel-btn">❌ Reject</button>
                            </form>
                        }
                        @if (order.Status == "In progress")
                        {
                            <form method="post" asp-controller="OrderTask" asp-action="MarkAsCompleted" asp-route-orderId="@order.OrderId">
                                <button type="submit" class="btn complete-btn">✅ Complete</button>
                            </form>
                            <form method="post" asp-controller="OrderTask" asp-action="CancelTask" asp-route-orderId="@order.OrderId">
                                <button type="submit" class="btn cancel-btn">❌ Reject</button>
                            </form>
                        }
                        @if (order.Status == "Completed" || order.Status == "Rejected")
                        {
                            <form method="post" asp-action="DeleteTask" asp-route-orderId="@order.OrderId" asp-controller="OrderTask">
                                <button type="submit" class="btn delete-btn">🗑️ Delete</button>
                            </form>
                        }
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <p class="no-requests">No transport orders available for this carrier.</p>
    }
</body>
</html>
